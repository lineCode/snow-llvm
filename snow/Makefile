TARGETS := snow.bc snow

AUTOGENERATED_SOURCES_snow := 
SOURCES_snow_bc := $(filter-out $(AUTOGENERATED_SOURCES_snow), $(wildcard *.c *.cpp))
SOURCES_snow_bc := $(AUTOGENERATED_SOURCES_snow) $(SOURCES_snow_bc)
OBJECTS_snow_bc = $(patsubst %,%.bc,$(SOURCES_snow_bc))

SOURCES_snow := $(wildcard driver/*.cpp driver/*.c)
OBJECTS_snow = $(patsubst %,%.o,$(SOURCES_snow))

EXTRA_CLEAN := $(AUTOGENERATED_SOURCES_snow)

include Makefile.rules

snow.bc: $(OBJECTS_snow_bc)
	$(BC_LD) -b $@ $(BC_LDFLAGS) $(OBJECTS_snow_bc)

LLVM_LIBS := LLVMAnalysis LLVMArchive LLVMBitReader LLVMBitWriter LLVMCodeGen \
			LLVMCore LLVMExecutionEngine LLVMInstCombine LLVMInstrumentation \
			LLVMInterpreter LLVMJIT LLVMLinker LLVMMC LLVMMCParser LLVMScalarOpts LLVMSelectionDAG \
			LLVMSupport LLVMSystem LLVMTarget LLVMTransformUtils LTO 
LLVM_PLATFORM_LIBS := LLVMX86CodeGen LLVMX86AsmPrinter LLVMX86Disassembler LLVMX86Info
LLVM_LIBS := $(LLVM_LIBS) $(LLVM_PLATFORM_LIBS)
LLVM_LIBS := $(patsubst %,$(LLVM_LIB_PATH)/lib%.a,$(LLVM_LIBS))
LLVM_LIBS := $(wildcard $(LLVM_LIB_PATH)/*.a)

snow: $(OBJECTS_snow)
	$(LD) $(LDFLAGS) $(OBJECTS_snow) $(LLVM_LIBS) -o $@


